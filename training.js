const playerNameInput = document.querySelector('#player-name');
const markerRadios = document.querySelectorAll('input[name="marker"]');
const startBtn = document.querySelector('#start-btn');
const restartBtn = document.querySelector('#restart-btn');

const initialScreen = document.querySelector('#initial-screen');
const gameScreen = document.querySelector('#game-screen');

const board = document.querySelector('#board');
const currentTurn = document.querySelector('#current-turn');

let playerName = '';
let playerMarker = '';
let computerMarker = '';
let boardState = Array(9).fill('');
let cells = [];
let isPlayerTurn = true;

//startGame()
// 1) –ë–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏. –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å—Ç–∞–≤–∏–º –¥–µ—Ñ–æ–ª—Ç
// 2) –ù–∞—Ö–æ–¥–∏–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫ —Ç—É, –∫–æ—Ç–æ—Ä–∞—è —Å–µ–π—á–∞—Å –æ—Ç–º–µ—á–µ–Ω–∞ (checked === true)
// 3) –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–π —Ä–∞–¥–∏–æ ‚Äî –±–µ—Ä—ë–º –µ–≥–æ value, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º 'X' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
// 4) –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –º–∞—Ä–∫–µ—Ä—É –∏–≥—Ä–æ–∫–∞
// 5) –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
// 6) –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
// 7) –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º / —Ä–µ–Ω–¥–µ—Ä–∏–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
// 8) –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ —Å–µ–π—á–∞—Å —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞
// 9) –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ–¥–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∏–≥—Ä–æ–∫–∞ –∏ –µ–≥–æ –º–∞—Ä–∫–µ—Ä

const startGame = () => {
  playerName = playerNameInput.value.trim() || '–ò–≥—Ä–æ–∫';

  const selectedRadio = Array.from(markerRadios).find(radio => radio.checked);
  playerMarker = selectedRadio ? selectedRadio.value : 'X';
  computerMarker = playerMarker === 'X' ? 'O' : 'X';

  initialScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');

  createBoard();

  isPlayerTurn = true;
  currentTurn.textContent = `–•–æ–¥–∏—Ç: ${playerName} (${playerMarker})`;
}

//createBoard()
// (1) –æ—á–∏—â–∞–µ–º –¥–æ—Å–∫—É –Ω–∞ —Å–ª—É—á–∞–π –Ω–æ–≤–æ–π –∏–≥—Ä—ã
// (2) —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—è
// (3) –æ—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ —è—á–µ–µ–∫
// (4) –ø–∏—à–µ–º —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç 9 –∫–ª–µ—Ç–æ–∫
// (5) —Å–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç <div> –∫–ª–µ—Ç–∫–∏
// (6) –¥–æ–±–∞–≤–ª—è–µ–º CSS-–∫–ª–∞—Å—Å
// (7) —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –∫–ª–µ—Ç–∫–∏
// (8) –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –∫–ª–∏–∫–Ω–µ—Ç –Ω–∞ –∫–ª–µ—Ç–∫—É.
// (9) –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–µ—Ç–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
// (10) –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–µ—Ç–∫—É –≤ –º–∞—Å—Å–∏–≤

const createBoard = () => {
  board.innerHTML = '';
  boardState = Array(9).fill('');
  cells = [];

  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index = i;
    cell.addEventListener('click', () => handleCellClick(i), { once: true });
    board.appendChild(cell);
    cells.push(cell);
  };
};

//handleCellClick = (index) =>
// 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∫–ª–∏–∫–∞—Ç—å
// –ï—Å–ª–∏ —Å–µ–π—á–∞—Å –Ω–µ —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∂–¥—ë–º —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)
// –∏–ª–∏ –∫–ª–µ—Ç–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞ (—Ç–∞–º —Å—Ç–æ–∏—Ç X –∏–ª–∏ O) ‚Äî –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
// 2Ô∏è‚É£ –°—Ç–∞–≤–∏–º —Å–∏–º–≤–æ–ª –∏–≥—Ä–æ–∫–∞
// –æ–±–Ω–æ–≤–ª—è–µ–º ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ¬ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ
// –æ–±–Ω–æ–≤–ª—è–µ–º ¬´–≤–Ω–µ—à–Ω–µ–µ¬ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ (DOM)
// 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É –∏–≥—Ä–æ–∫–∞
// –≤—ã–∑—ã–≤–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∞—Å—å –ª–∏ –≤—ã–∏–≥—Ä—ã—à–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
// –≤—ã–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä–∞–≤—à–∏–µ –∫–ª–µ—Ç–∫–∏
// –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç —Å–≤–µ—Ä—Ö—É
// –±–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∫–ª–∏–∫–∏
// –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –∏–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞
// 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ª–∏ –≤—Å–µ –∫–ª–µ—Ç–∫–∏
// –µ—Å–ª–∏ –≤—Å—ë –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –Ω–∏—á—å—è
// 5Ô∏è‚É£ –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–µ–Ω–∞ ‚Äî –ø–µ—Ä–µ–¥–∞—ë–º —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä—É
// –∑–∞–ø—Ä–µ—â–∞–µ–º –∏–≥—Ä–æ–∫—É –∫–ª–∏–∫–∞—Ç—å
// –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ö–æ–¥ –∑–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º
// –∂–¥—ë–º 0.5 —Å–µ–∫—É–Ω–¥—ã ‚Äî –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ ‚Äî –∏ –≤—ã–∑—ã–≤–∞–µ–º —Ö–æ–¥ –ò–ò

const handleCellClick = (index) => {
  if (!isPlayerTurn || boardState[index] !== '');

  boardState[index] = playerMarker;
  cells[index].textContent = playerMarker;

  const winCombo = checkWin(playerMarker);
  if (winCombo) {
    highlightWinningCells(winCombo);
    currentTurn.textContent = `${playerName} –ø–æ–±–µ–¥–∏–ª! üéâ`;
    disableBoard();
    return;
  }

  if (isBoardFull()) {
    currentTurn.textContent = '–ù–∏—á—å—è ü§ù';
    disableBoard();
    return;
  }

  isPlayerTurn = false;
  currentTurn.textContent = '–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞...';
  setTimeout(computerMove, 500);
}

//computerMove = ()
// 1Ô∏è‚É£ –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
// –µ—Å–ª–∏ —è—á–µ–π–∫–∞ –ø—É—Å—Ç–∞—è ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ—ë –∏–Ω–¥–µ–∫—Å
// —É–±–∏—Ä–∞–µ–º –≤—Å–µ null, –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
// –ï—Å–ª–∏ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫ –Ω–µ—Ç ‚Äî –≤—ã—Ö–æ–¥–∏–º
// 2Ô∏è‚É£ –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–ª–µ—Ç–∫—É –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è
// 3Ô∏è‚É£ –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
// –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–º–∞—Å—Å–∏–≤)
// –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∏–º–≤–æ–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
// 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî –≤—ã–∏–≥—Ä–∞–ª –ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä
// –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à
// –≤—ã–≤–æ–¥–∏–º –ø–æ–±–µ–¥—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
// –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
// –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
// 5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–∏—á—å—é
// 6Ô∏è‚É£ –ï—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –≤—ã–∏–≥—Ä–∞–ª ‚Äî —Ö–æ–¥ —Å–Ω–æ–≤–∞ –∏–≥—Ä–æ–∫–∞

const computerMove = () => {
  const emptyIndices = boardState
    .map((v, i) => v === '' ? i : null)
    .filter(i => i !== null)
  if (emptyIndices.length === 0) return;

  const randomIndex = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];

  boardState[randomIndex] = computerMarker;
  cells[randomIndex].textContent = computerMarker;

  const winCombo = checkWin(computerMarker);
  if (winCombo) {
    highlightWinningCells(winCombo);
    currentTurn.textContent = `–ö–æ–º–ø—å—é—Ç–µ—Ä (${computerMarker}) –ø–æ–±–µ–¥–∏–ª ü§ñ`;
    disableBoard();
    return;
  }

  if (isBoardFull()) {
    currentTurn.textContent = '–ù–∏—á—å—è ü§ù';
    disableBoard();
    return;
  }

  isPlayerTurn = true;
  currentTurn.textContent = `–•–æ–¥–∏—Ç: ${playerName} (${playerMarker})`;
};

//checkWin()
// 1Ô∏è‚É£ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π (–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)
// - –ö–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è ‚Äî –º–∞—Å—Å–∏–≤ –∏–∑ —Ç—Ä—ë—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (0..8)
// - –ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–ª—è 3x3 —ç—Ç–æ 3 —Å—Ç—Ä–æ–∫–∏, 3 —Å—Ç–æ–ª–±—Ü–∞ –∏ 2 –¥–∏–∞–≥–æ–Ω–∞–ª–∏
/* [0,1,2], [3,4,5], [6,7,8], // —Å—Ç—Ä–æ–∫–∏
 [0,3,6], [1,4,7], [2,5,8], // —Å—Ç–æ–ª–±—Ü—ã
 [0,4,8], [2,4,6]           // –¥–∏–∞–≥–æ–Ω–∞–ª–∏ */
// 2Ô∏è‚É£ –ü–µ—Ä–µ–±—Ä–∞—Ç—å –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –Ω–∞–π—Ç–∏ —Ç–æ—Ç, –≥–¥–µ –≤—Å–µ 3 –∫–ª–µ—Ç–∫–∏ —Ä–∞–≤–Ω—ã marker
// 3Ô∏è‚É£ –í–µ—Ä–Ω—É—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∏–ª–∏ null, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç

const checkWin = (marker) => {
  const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];

  const findWinningPattern = () => {
    const foundPattern = winPatterns
      .find(pattern => pattern.every(index => boardState[index] === marker));

    return foundPattern || null;
  }

  return findWinningPattern();
};

//highlightWinningCells(combo)
// üîπ –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª–µ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
// –ü–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
// –µ—Å–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
// –¥–æ–±–∞–≤–ª—è–µ–º CSS-–∫–ª–∞—Å—Å "win"

const highlightWinningCells = (combo) => {
  if (!combo) return;
  combo.forEach(i => cells[i].classList.add('win'));
};

//isBoardFull()
// üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∏—á—å—é
// –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –º–∞—Å—Å–∏–≤–∞ boardState
// –µ—Å–ª–∏ –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –Ω–µ –ø—É—Å—Ç—ã–µ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true (–ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)
// –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø—É—Å—Ç–∞—è ‚Üí false

const isBoardFull = () => boardState.every(cell => cell !== '');

//disableBoard()
// üîπ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—è, —á—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ —Ö–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
// –ü–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ö–æ–¥
// –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–ª–µ—Ç–æ–∫ cells
// —Å–æ–∑–¥–∞—ë–º –ø–æ–ª–Ω—É—é –∫–æ–ø–∏—é DOM-—ç–ª–µ–º–µ–Ω—Ç–∞(–∫–ª–µ—Ç–∫–∏) –±–µ–∑ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.
// –∑–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—É—é –∫–ª–µ—Ç–∫—É –Ω–∞ –Ω–æ–≤—É—é

const disableBoard = () => {
  cells.forEach(cell => {
    const newCell = cell.cloneNode(true);
    cell.replaceWith(newCell);
  })
}

//restartGame()
// üîπ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
// –°–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
// –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
// –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ–¥–∞
// –û—á–∏—â–∞–µ–º DOM –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
// –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–æ–≥–∏–∫—É –∏–≥—Ä—ã

const restartGame = () => {
  gameScreen.classList.add('hidden');
  initialScreen.classList.remove('hidden');
  playerNameInput.value = '';
  currentTurn.textContent = '';
  markerRadios.forEach((r, i) => {
    r.checked = i === false;
  })
  board.innerHTML = '';
  boardState = Array(9).fill('');
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', restartGame);
